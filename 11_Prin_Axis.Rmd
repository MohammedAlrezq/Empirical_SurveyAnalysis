---
title: "11_Prin_Axis"
author: "Mohammed Alrezq"
date: "2023-08-03"
output:
  pdf_document: default
  html_document: default
  word_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# 1. Preliminary 
### 1.1 Load libraires: this need to be 
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(psych)# use perform EFA
library(purrr)
library(ggplot2)
library(gridExtra)# to arrnge plot per row and col
library(corrr)
```


```{r}
plotTheme <- function() {
  theme(
    plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
    plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
    plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0), 
    axis.title.x = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = -0.5),
    axis.title.y = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = 1),
    axis.text = element_text(size = 9, family = "sans", face = "plain"),
    panel.background = element_blank(),
    panel.grid.minor = element_line(colour = "gray"),
    panel.grid.major = element_line(colour = "gray"),
    axis.ticks = element_blank(),
    legend.title = element_text(size = 10, family = "sans"),
    legend.text = element_text(size = 9, family = "sans"),
    axis.line = element_blank()
  )
}
```

## 1.2 load data
```{r}
model_11 <- read.csv("mean_data.csv")

# Remove Response.ID and col X from the data 
model_11 <- model_11 |> 
  select(c(-Response.ID, -X))

# Convert all integer columns to numeric
model_11 <- model_11 |> 
  mutate_if(is.integer, as.numeric)
```

## 1.3 Split data to dependent and independet variables 
```{r}
# Dependent variables/items 
model_11_DVs <- model_11 |> 
  select(1:13)
# Independent variables/items 
model_11_IVs <- model_11 |> 
  select(14:42)
#str(model_11_IVs)
```

# 2 Statistical descriptive
## 2.1 Statistical summary for all variables/itmes 
```{r}
library(vtable)# to print summary table 
Model_11_stat <- describe(model_11, fast = TRUE)# fast = TRUE allow to compute only common stat summary, such as mean, SD, etc.
model_11_sum.stat <- sumtable(model_11,
         summ = c('notNA(x)',
                  'mean(x)',
                  'median(x)',
                  'sd(x)',
                  'min(x)',
                  'max(x)'),
         title = "Descriptive Statistic of variables/itmes")

#psych::describe(model_11, fast = TRUE)
```

## 2 Principle Axis factoring for Dependent Variables/items
### 2.1 Correlation Matrix 
```{r}
model_11_DV_corr <- round(cor(model_11_DVs), 2) # Correlation matrix

# Plot the correlation matrix for DVs 
library(corrplot)# to plot the correlation matrix 
corrplot(model_11_DV_corr, 
         method= "number",
         tl.col = "black")# label variable in black

```

### 2.2 Diagnostic Test 
#### A.Kaiser-Meyer-Olkin index (KMO)

**Kaiser’s 1974 recommendations were:**
- bare minimum of .5
- values between .5 and .7 as mediocre
- values between .7 and .8 as good
- values above .9 are superb
```{r}
KMO(model_11_DVs)

# KMO = 0.90
# Variables at item level > 0.50, which is adequate for sample size 
```
#### B.Bartlett’s test
* A significant Barlett’s ($p < 0.05$) tells that the $R$-matrix is not an identity matrix. That is, there are some relationships between variables that can be analyzed
- The result of $p-value = 0.7.08*10^94$

```{r}
psych::cortest.bartlett(model_11_DVs)
```
#### C. Multicollinearity or singularity in my data
* Determinant of the correlation matrix
- Det. of the correlation matrix should be greater than 0.00001
- The result of deteriminant is $1.802578e-05$
```{r}
det(cor(model_11_DVs))
```

### D. Principle Axis Factoring 
```{r}
model_11_DV_4F <- psych::fa(model_11_DVs, nfactors = 4, fm = "pa", rotate = "none")
```
### E. scree
```{r}
# to check all the info within PAF
names(model_11_DV_4F)

# Scree plot 
plot(model_11_DV_4F$values, type = "b")


```



```{r}
#EMPL_SKI and ORG_IMP = 0.79
#EMPL_SAT and STAKEH_ACC = 0.75
#DVs = 5

#IVs
##CONTX_CUS and TOOL_AP = 0.78
#LD_SUP and CULT_INTG =0.75
#LD_STL and LD_INV =0.75
#INSTIT and ACT_INTG=0.75
#TEAM_ST and LD_STL=.75



model_11_reduced <- model_11 |> 
  select(-c(EMPL_SKI, ORG_IMP, CONTX_CUS, TOOL_AP))
det(cor(model_11_reduced))
# Any correlation >= 0.75 was removed 
model_11_reduced_2 <- model_11 |> 
  select(-c(EMPL_SKI, ORG_IMP, EMPL_SAT, STAKEH_ACC, LD_SUP, CULT_INTG, LD_STL, LD_INV, INSTIT, ACT_INTG, TEAM_ST, CONTX_CUS, TOOL_AP))
det(cor(model_11_reduced_2))


#ORG_IMP and IMPL_SUCC
#EMPL_SAT and IMPL_SUCC
#EMPL_SAT and ORG_IMP
# EMP_ATT nd EMPL_BEL
# PRJ_SEL and TASK_COMP
#DEF_MEA and PRJ_SEL
#ORG_CHR and DEF_MEA
#DAT_QLT and DEF_MEA
#SCOPE and EFT_REQ

model_11_reduced_3 <- model_11 |> 
  select(-c(EMPL_SKI, ORG_IMP, EMPL_SAT, STAKEH_ACC, LD_SUP, CULT_INTG, LD_STL, LD_INV, INSTIT, ACT_INTG, TEAM_ST, CONTX_CUS, TOOL_AP, IMPL_SUCC, EMP_ATT, EMPL_BEL, PRJ_SEL, TASK_COMP, DEF_MEA, ORG_CHR, DAT_QLT, SCOPE, EFT_REQ))
det(cor(model_11_reduced_3))

det(model_11_Corr)

```
# Split the data to DV and IV

```{r}
names(model_11)
mode_11_DVs <- model_11 |> 
  select(1:13)

model_11_IVs <- model_11 |> 
  select(14:42)
```

# cHECK 
## Dependent variabels 

```{r}
# Correlation matrix 
model_11_DVs_Corr <- round(cor(mode_11_DVs), 2)

#Kaiser-Meyer-Olkin index (KMO)
KMO(mode_11_DVs)

#Bartlett’s test
psych::cortest.bartlett(mode_11_DVs)

#Determinant of the correlation matrix
# - For multicollinearity or singularity in my data
# - Det. of the correlation matrix should be greater than 0.00001
det(cor(mode_11_DVs))
# 0.0000018
```
## Independent variabels 
```{r}
# Correlation matrix 
model_11_IVs_Corr <- round(cor(model_11_IVs), 2)
#write.csv(model_11_IVs_Corr, "IVs_Correaltion.csv")

#Kaiser-Meyer-Olkin index (KMO)
KMO(model_11_IVs)

#Bartlett’s test
psych::cortest.bartlett(model_11_IVs)

#Determinant of the correlation matrix
# - For multicollinearity or singularity in my data
# - Det. of the correlation matrix should be greater than 0.00001
det(cor(model_11_IVs))
# 2.8*10^-12
```

## Independent variables
- remove correlated variables with 0.73 or above 
```{r}

# remove CONTX_CUS and TOOL_AP
# LD_STL and LD_INV = 0.78
#LD_STL and TEAM_ST =0.75
#ORG_CUL and LD_SUP = 0.74
#DEF_MEA and PRJ_SEL =0.73
# SCOPE and EFT_REQ = 0.73
# LD_STL and LD_SUP = 0.72
# ORG_CHR and DEF_MEA = 0.72

model_11_IVs_reduced <- model_11_IVs |> 
  select(-c(CONTX_CUS, TOOL_AP, LD_STL, TEAM_ST, LD_INV, ORG_CUL, LD_SUP, SCOPE, EFT_REQ, LD_STL, LD_SUP, ORG_CHR, DEF_MEA))
det(cor(model_11_IVs_reduced))

#Kaiser-Meyer-Olkin index (KMO)
KMO(model_11_IVs_reduced)

#Bartlett’s test
psych::cortest.bartlett(model_11_IVs_reduced)

```



