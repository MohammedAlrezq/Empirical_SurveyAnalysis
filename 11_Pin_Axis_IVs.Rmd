---
title: "11_Pin_Axis_IVs"
author: "Mohammed Alrezq"
date: "2023-08-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Preliminary 
### 1.1 Load libraires: this need to be 
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(psych)# use perform EFA
library(purrr)
library(ggplot2)
library(gridExtra)# to arrnge plot per row and col
library(corrr)
```


```{r,}
plotTheme <- function() {
  theme(
    plot.title = element_text(size = 14, family = "sans", face = "plain", hjust = 0),
    plot.subtitle=element_text(size = 11, family = "sans", hjust = 0),
    plot.caption=element_text(size = 10, family = "sans", face = "italic", hjust = 0), 
    axis.title.x = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = -0.5),
    axis.title.y = element_text(size = 10, family = "sans", face = "plain", hjust = 1, vjust = 1),
    axis.text = element_text(size = 9, family = "sans", face = "plain"),
    panel.background = element_blank(),
    panel.grid.minor = element_line(colour = "gray"),
    panel.grid.major = element_line(colour = "gray"),
    axis.ticks = element_blank(),
    legend.title = element_text(size = 10, family = "sans"),
    legend.text = element_text(size = 9, family = "sans"),
    axis.line = element_blank()
  )
}
```

## 1.2 load data
```{r}
model_11 <- read.csv("mean_data.csv")

# Remove Response.ID and col X from the data 
model_11 <- model_11 |> 
  select(c(-Response.ID, -X))

# Convert all integer columns to numeric
model_11 <- model_11 |> 
  mutate_if(is.integer, as.numeric)
```

## 1.3 Split data to dependent and independet variables 
```{r}
# Dependent variables/items 
model_11_DVs <- model_11 |> 
  select(1:13)
#str(model_11_DVs)
# Independent variables/items 
model_11_IVs <- model_11 |> 
  select(14:42)
#str(model_11_IVs)
```


# Number of factors is 6 factors
```{r}
# with factor = 6
set.seed(3233)
model_11_IV_F6 <- psych::fa(model_11_IVs,nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6, cut = 0.3, sort=TRUE)

names(model_11_IV_F6)
mean(model_11_IV_F6$communality)
names(model_11_IVs)


################Experimenting removing some items from IVs with 6 factors ###########################################
# remove EXT_CON_21
set.seed(32433)
model_11_IV_F6_EXT_CON_21 <- psych::fa(model_11_IVs[, -which(names(model_11_IVs) == "EXT_CON_21")],nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6_EXT_CON_21, cut = 0.3, sort=TRUE)

# remove EMP_ENG_12, INSTIT_17, "EXT_CON_21", COM_KNW_23, GOAL_CL_25, "GOAL_AL_27", TEAM_ST_29: these items has highest cross loading >0.75
set.seed(32499)
model_11_IV_F6_Delt_7items <- psych::fa(model_11_IVs
                                        [, !names(model_11_IVs) %in% c("EMP_ENG_12", "INSTIT_17", "EXT_CON_21", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", "TEAM_ST_29")]
                                        ,nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6_Delt_7items, cut = 0.3, sort=TRUE)

# remove "ORG_CUL_2", "EMP_ATT_3", TOOL_AP_13: these items also added to the above as they resutled with cross loading >0.75
set.seed(32009)
model_11_IV_F6_Delt_10items <- psych::fa(model_11_IVs
                                        [, !names(model_11_IVs) %in% c("ORG_CUL_2", "EMP_ATT_3" ,"EMP_ENG_12", "TOOL_AP_13" ,"INSTIT_17", "EXT_CON_21", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", "TEAM_ST_29")]
                                        ,nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6_Delt_10items, cut = 0.3, sort=TRUE)

# Remove "RES_CHG_8", "TEAM_ST_29", "INSTIT_17", "GOAL_CL_25", "GOAL_AL_27", "COM_KNW_23", "EMP_ENG_12", "RES_CHG_8", "EXT_CON_21"
names(model_11_IVs)
set.seed(000012)
model_11_IV_F6_Delt_9items <- psych::fa(model_11_IVs
                                        [, !names(model_11_IVs) %in% c("RES_CHG_8", "TEAM_ST_29", "INSTIT_17", "GOAL_CL_25", "GOAL_AL_27", "COM_KNW_23", "EMP_ENG_12", "RES_CHG_8", "EXT_CON_21")]
                                        ,nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6_Delt_9items, cut = 0.3, sort=TRUE)
# Note: the resutls have many cross loading and possibility of having a factor with 1 item

# Remove "RES_CHG_8", "TEAM_ST_29", "INSTIT_17", "GOAL_CL_25", "GOAL_AL_27", "COM_KNW_23", "EMP_ENG_12"
names(model_11_IVs)
set.seed(0000129)
model_11_IV_F6_Delt_7items <- psych::fa(model_11_IVs
                                        [, !names(model_11_IVs) %in% c("RES_CHG_8", "TEAM_ST_29", "INSTIT_17", "GOAL_CL_25", "GOAL_AL_27", "COM_KNW_23", "EMP_ENG_12")]
                                        ,nfactors = 6, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F6_Delt_7items, cut = 0.3, sort=TRUE)
```


# Number of factors is 5 factors
```{r}
# with factor = 5
set.seed(232333)
model_11_IV_F5 <- psych::fa(model_11_IVs,nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5, cut = 0.3, sort=TRUE)

# Mean communality
mean(model_11_IV_F5$communality)
names(model_11_IVs)

# Remove "ORG_CUL_2", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27"
set.seed(00333)
model_11_IV_F5_Delt_4itmes <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("ORG_CUL_2", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_4itmes, cut = 0.3, sort=TRUE)

# Remove "ORG_CUL_2", EMP_ENG_12 , SCOPE_16, EXT_CON_21, "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", TEAM_ST_29, 
set.seed(111123)
model_11_IV_F5_Delt_8itmes <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("ORG_CUL_2", "EMP_ENG_12", "SCOPE_16", "EXT_CON_21", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", "TEAM_ST_29")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_8itmes, cut = 0.3, sort=TRUE)


# Remove "ORG_CUL_2", "EMP_ATT_3", EMP_ENG_12 , SCOPE_16, EXT_CON_21, "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", TEAM_ST_29, 
set.seed(1111230)
model_11_IV_F5_Delt_9itmes <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("ORG_CUL_2", "EMP_ATT_3", "EMP_ENG_12", "SCOPE_16", "EXT_CON_21", "COM_KNW_23", "GOAL_CL_25", "GOAL_AL_27", "TEAM_ST_29")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_9itmes, cut = 0.3, sort=TRUE)


# Remove "GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23", "EXT_CON_21", "RES_CHG_8" 
set.seed(111123030)
model_11_IV_F5_Delt_6itmes <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23", "EXT_CON_21", "RES_CHG_8" )],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_6itmes, cut = 0.3, sort=TRUE)

# Remove "GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23", "EXT_CON_21", "RES_CHG_8". further remove: "EMP_ENG_12",  "SCOPE_16", "TEAM_ST_29", "SYS_COM_28", "ORG_CHR_10"
set.seed(1111230300)
model_11_IV_F5_Delt_10itmes <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23", "EXT_CON_21", "RES_CHG_8", "EMP_ENG_12",  "SCOPE_16", "TEAM_ST_29", "SYS_COM_28", "ORG_CHR_10")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_10itmes, cut = 0.3, sort=TRUE)
# Note: this setting lead to Heywood case. STOP here

# Remove "GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23"
set.seed(0001)
model_11_IV_F5_Delt_4itmes2 <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_4itmes2, cut = 0.3, sort=TRUE)

# Remove "GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23". further remove: "SCOPE_16", "EXT_CON_21", "TEAM_ST_29", "EMP_ENG_12"
set.seed(000121)
model_11_IV_F5_Delt_8itmes2 <- psych::fa(model_11_IVs 
                                        [, !names(model_11_IVs) %in% c("GOAL_AL_27", "ORG_CUL_2", "GOAL_CL_25", "COM_KNW_23", "SCOPE_16", "EXT_CON_21", "TEAM_ST_29", "EMP_ENG_12")],
                                        nfactors = 5, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F5_Delt_8itmes2, cut = 0.3, sort=TRUE)
```

# Number of factors is 5 factors. Uisng Oblique "cluster"
```{r}
# with factor = 5
set.seed(2323300)
model_11_IV_F5_Promax <- psych::fa(model_11_IVs[, -which(names(model_11_IVs) == "SCOPE_16")],nfactors = 5, fm = "pa", rotate = "cluster", max.iter = 100)
psych::print.psych(model_11_IV_F5_Promax, cut = 0.3, sort=TRUE)
# this solution may mak4e sense but need to kknow the cluster method 
```



# Number of factors is 4 factors
```{r}
# with factor = 4
set.seed(2322)
model_11_IV_F4 <- psych::fa(model_11_IVs,nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4, cut = 0.3, sort=TRUE)

# mean communality 
mean(model_11_IV_F4$communality)

# Remove "ORG_CUL_2", "EMP_ATT_3", "LD_STL_9",  "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", 
set.seed(232200)
model_11_IV_F4_delt_6items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("ORG_CUL_2", "EMP_ATT_3", "LD_STL_9",  "SCOPE_16", "COM_KNW_23", "GOAL_CL_25")],
                                        nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4_delt_6items, cut = 0.3, sort=TRUE)


# Remove "ORG_CUL_2", "EMP_ATT_3", "LD_STL_9",  "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", more remove: "LD_SUP_1", "RES_CHG_8", "EXT_CON_21"
set.seed(232299)
model_11_IV_F4_delt_9items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("ORG_CUL_2", "EMP_ATT_3", "LD_STL_9",  "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "LD_SUP_1", "RES_CHG_8", "EXT_CON_21")],
                                        nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4_delt_9items, cut = 0.3, sort=TRUE)

#######08/14
# Remove "ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8"
set.seed(2345454)
model_11_IV_F4_delt_7items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8")],
                                        nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4_delt_7items, cut = 0.3, sort=TRUE)

#Remove "ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8". further remove: LD_SUP_1
set.seed(23400454)
model_11_IV_F4_delt_8items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8", "LD_SUP_1")],
                                        nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4_delt_8items, cut = 0.3, sort=TRUE)

# Remove "ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8". further remove: LD_SUP_1. further remove "EMP_ENG_12", "GOAL_AL_27"
set.seed(00454)
model_11_IV_F4_delt_10items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("ORG_CUL_2", "LD_STL_9", "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "EXT_CON_21", "RES_CHG_8", "LD_SUP_1", "EMP_ENG_12", "GOAL_AL_27")],
                                        nfactors = 4, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F4_delt_10items, cut = 0.3, sort=TRUE)

mean(model_11_IV_F4_delt_10items$communality)
```


# Number of factors is 3 factors
```{r}
# with factor = 3
set.seed(23225)
model_11_IV_F3 <- psych::fa(model_11_IVs,nfactors = 3, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F3, cut = 0.3, sort=TRUE)

# Mean communality 
mean(model_11_IV_F3$communality)
# remove "EMP_ATT_3", RES_AVL_4", "RES_CHG_8", "EXP_CON_20", "EXT_CON_21", "COM_KNW_23"
set.seed(23445)
model_11_IV_F3_dlt_6items <- psych::fa(model_11_IVs [, !names(model_11_IVs) %in% c("EMP_ATT_3", "RES_AVL_4", "RES_CHG_8", "EXP_CON_20", "EXT_CON_21", "COM_KNW_23")],
                                       nfactors = 3, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F3_dlt_6items, cut = 0.3, sort=TRUE)


# remove "EMP_ATT_3", RES_AVL_4", "RES_CHG_8", "EXP_CON_20", "EXT_CON_21", "COM_KNW_23". further remove: "SYS_COM_28", "UND_CNG_22"
set.seed(2344511)
model_11_IV_F3_dlt_8items <- psych::fa(model_11_IVs[, !names(model_11_IVs) %in% c("EMP_ATT_3", "RES_AVL_4", "RES_CHG_8", "EXP_CON_20", "EXT_CON_21", "COM_KNW_23", "SYS_COM_28", "UND_CNG_22")],
                                       nfactors = 3, fm = "pa", rotate = "oblimin", max.iter = 100)
psych::print.psych(model_11_IV_F3_dlt_8items, cut = 0.3, sort=TRUE)
mean(model_11_IV_F3_dlt_8items$communality)
```

#### Principle Component analysis 
- Determine number of factors using eigenvalues 
```{r}
# NO. of factor for   IVs
model_11_IVs_PCA <- psych::principal(model_11_IVs, nfactors = length(model_11_IVs), rotate = "none")
# 7 Components > 1

```


#### PCA with 7 components 
```{r}
# No. of factors 7 
set.seed(1115)
model_11_IVs_7PCA <- psych::principal(model_11_IVs, nfactors = 7, rotate = "oblimin")
psych::print.psych(model_11_IVs_7PCA, cut = 0.3, sort=TRUE)
```

#### PCA with 6 components 
```{r}
# No. of factors 6
set.seed(11156)
model_11_IVs_6PCA <- psych::principal(model_11_IVs, nfactors = 6, rotate = "oblimin")
psych::print.psych(model_11_IVs_6PCA, cut = 0.3, sort=TRUE)


# remove "EMP_ATT_3", "SCOPE_16", "TEAM_ST_29", "INSTIT_17"
set.seed(111560)
model_11_IVs_6PCA_delt_4items <- psych::principal(model_11_IVs[, !names(model_11_IVs) %in% c("EMP_ATT_3", "SCOPE_16", "TEAM_ST_29", "INSTIT_17")], nfactors = 6, rotate = "oblimin")
psych::print.psych(model_11_IVs_6PCA_delt_4items, cut = 0.3, sort=TRUE)
# Note: not good 
```


#### PCA with 5 components 
```{r}
# No. of factors 5
set.seed(11100)
model_11_IVs_5PCA <- psych::principal(model_11_IVs, nfactors = 5, rotate = "oblimin")
psych::print.psych(model_11_IVs_5PCA, cut = 0.3, sort=TRUE)

# remove "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "ORG_CUL_2"
set.seed(5500)
model_11_IVs_5PCA_delt4items <- psych::principal(model_11_IVs[, !names(model_11_IVs) %in% c("SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "ORG_CUL_2")], nfactors = 5, rotate = "oblimin")
psych::print.psych(model_11_IVs_5PCA_delt4items, cut = 0.3, sort=TRUE)


# remove "SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "ORG_CUL_2". further remove: "EMP_ATT_3", "LD_SUP_1", "LD_INV_5", "TEAM_ST_29"
set.seed(55009)
model_11_IVs_5PCA_delt8items <- psych::principal(model_11_IVs[, !names(model_11_IVs) %in% c("SCOPE_16", "COM_KNW_23", "GOAL_CL_25", "ORG_CUL_2", "EMP_ATT_3", "LD_SUP_1", "LD_INV_5", "TEAM_ST_29")],
                                                 nfactors = 5, rotate = "oblimin")
psych::print.psych(model_11_IVs_5PCA_delt8items, cut = 0.3, sort=TRUE)
```

#### PCA with 4 components 
```{r}
# No. of factors 4
set.seed(11100)
model_11_IVs_4PCA <- psych::principal(model_11_IVs, nfactors = 4, rotate = "oblimin")
psych::print.psych(model_11_IVs_4PCA, cut = 0.3, sort=TRUE)

names(model_11_IVs)
#remove "SCOPE_16", "LD_STL_9", "ORG_CUL_2", "EMP_ATT_3", "GOAL_CL_25", "LD_SUP_1"
set.seed(111002)
model_11_IVs_4PCA_delt5items <- psych::principal(model_11_IVs[, !names(model_11_IVs) %in% c("SCOPE_16", "LD_STL_9", "ORG_CUL_2", "EMP_ATT_3", "GOAL_CL_25", "LD_SUP_1")], nfactors = 4, rotate = "oblimin")
psych::print.psych(model_11_IVs_4PCA_delt5items, cut = 0.3, sort=TRUE)
# Note: this might be good soltuion
```